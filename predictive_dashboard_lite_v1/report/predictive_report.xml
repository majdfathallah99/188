<?xml version="1.0" encoding="UTF-8"?>
<odoo>
  <template id="predictive_report_tmpl">
    <!-- external_layout provides header, footer, and proper meta charset -->
    <t t-call="web.external_layout">

      <div class="o_report_layout_standard"
           lang="ar" dir="rtl"
           style="text-align:right; font-family:'Cairo','NotoNaskhArabic','DejaVu Sans',sans-serif">

        <h2 style="margin:0 0 8px 0;">Predictive Forecast</h2>

        <div style="margin-bottom:12px;">
          <p style="margin:0;"><strong>Company:</strong> <span t-esc="docs.company_id.display_name"/></p>
          <p style="margin:0;">
            <strong>Period:</strong>
            <span t-esc="docs.date_from"/> &#x0625;&#x0644;&#x0649; <span t-esc="docs.date_to"/>
          </p>
          <p style="margin:0;"><strong>Method:</strong> <span t-esc="docs.method"/></p>
          <p style="margin:0;"><strong>Group by:</strong> <span t-esc="docs.group_by"/></p>
        </div>

        <table class="o_main_table" style="width:100%; border-collapse:collapse; direction:ltr; text-align:left;">
          <thead>
            <tr>
              <th style="border-bottom:1px solid #ccc; padding:6px 8px; width:36%;">Key</th>
              <th style="border-bottom:1px solid #ccc; padding:6px 8px;">UoM</th>
              <th style="border-bottom:1px solid #ccc; padding:6px 8px;">Qty in Window</th>
              <th style="border-bottom:1px solid #ccc; padding:6px 8px;">Daily Rate</th>
              <th style="border-bottom:1px solid #ccc; padding:6px 8px;">Forecast</th>
              <th style="border-bottom:1px solid #ccc; padding:6px 8px;">On Hand</th>
              <th style="border-bottom:1px solid #ccc; padding:6px 8px; white-space:nowrap;">Days till Shortage</th>
              <th style="border-bottom:1px solid #ccc; padding:6px 8px;">Shortage Date</th>
            </tr>
          </thead>
          <tbody>
            <t t-foreach="docs.line_ids" t-as="l">
              <tr>
                <td style="padding:6px 8px; direction:rtl; unicode-bidi:isolate-override; white-space:normal;">
                  <t t-esc="l.display_key or ''"/>
                </td>
                <td style="padding:6px 8px;"><t t-esc="l.uom_id.display_name or ''"/></td>
                <td style="padding:6px 8px;"><t t-esc="'%.2f' % (l.qty_window or 0.0)"/></td>
                <td style="padding:6px 8px;"><t t-esc="'%.4f' % (l.daily_rate or 0.0)"/></td>
                <td style="padding:6px 8px;"><t t-esc="'%.2f' % (l.forecast_qty or 0.0)"/></td>
                <td style="padding:6px 8px;"><t t-esc="'%.2f' % (max(l.stock_onhand or 0.0, 0.0))"/></td>
                <td style="padding:6px 8px;">
                  <t t-if="(l.days_until_shortage or 0.0) &gt; 0.0" t-esc="'%.0f' % l.days_until_shortage"/>
                  <t t-else="1">â€”</t>
                </td>
                <td style="padding:6px 8px;"><t t-esc="l.shortage_date or ''"/></td>
              </tr>
            </t>
          </tbody>
        </table>
      </div>
    </t>
  </template>
</odoo>
